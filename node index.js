const { Client, LocalAuth } = require('whatsapp-web.js');
const qrcode = require('qrcode-terminal');

// ุฅุนุฏุงุฏ ุงูุนููู (ุงูุจูุช)
const client = new Client({
    authStrategy: new LocalAuth(),
    puppeteer: {
        args: ['--no-sandbox', '--disable-setuid-sandbox'] // ุถุฑูุฑู ุฌุฏุงู ููุนูู ุนูู ุงูุณูุฑูุฑุงุช
    }
});

// ุฑููู ุงูุฎุงุต ุงูุฐู ุณูุณุชูุจู ุงูุฑูุงุจุท (ุชู ุชูุณููู ุชููุงุฆูุงู)
const MY_PERSONAL_NUMBER = '966590841275@c.us';

// ุนูุฏ ุชุดุบูู ุงูุจูุชุ ุฅุธูุงุฑ ููุฏ QR
client.on('qr', (qr) => {
    console.log('ุงูุณุญ ุงูุฑูุฒ ุงูุชุงูู ุจุงุณุชุฎุฏุงู ูุงุชุณุงุจ (ุงูุฑูู ุงููุฎุตุต ููุจูุช):');
    qrcode.generate(qr, { small: true });
});

// ุนูุฏ ูุฌุงุญ ุงูุงุชุตุงู
client.on('ready', () => {
    console.log('โ ุงูุจูุช ุฌุงูุฒ! ุณูููู ุจูุฑุงูุจุฉ ุงูุฑูุงุจุท ูุฅุฑุณุงููุง ุฅูู ุฑููู 966590841275.');
});

// ุงูุงุณุชูุงุน ููุฑุณุงุฆู ุงููุงุฏูุฉ
client.on('message', async msg => {
    // ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ุชุญุชูู ุนูู ุฑุงุจุท ูุฌููุนุฉ ูุงุชุณุงุจ
    if (msg.body.includes('chat.whatsapp.com')) {
        
        // ูุญุงููุฉ ุงูุญุตูู ุนูู ุงุณู ุงููุฌููุนุฉุ ุฃู ุงุณุชุฎุฏุงู "ูุญุงุฏุซุฉ" ุฅุฐุง ูู ูุชููุฑ ุงูุงุณู
        let chatName = 'ูุญุงุฏุซุฉ';
        try {
            const chat = await msg.getChat();
            chatName = chat.name || 'ูุญุงุฏุซุฉ';
        } catch (e) {
            // ุชุฌุงูู ุงูุฎุทุฃ ุฅุฐุง ูุดู ุฌูุจ ูุนูููุงุช ุงูุดุงุช
        }
        
        // ุชุฌููุฒ ุงูุฑุณุงูุฉ
        const reportMessage = `
๐ *ุชู ุงูุชูุงุท ุฑุงุจุท ูุฌููุนุฉ!*

๐ *ุงููุตุฏุฑ:* ${chatName}
๐ค *ุงููุฑุณู:* ${msg.from.split('@')[0]}
๐ *ุงูุฑุงุจุท:*
${msg.body}
        `;

        // ุฅุฑุณุงู ุงูุฑุงุจุท ุฅูู ุฑููู ุงูุฎุงุต
        try {
            await client.sendMessage(MY_PERSONAL_NUMBER, reportMessage);
            console.log(`ุชู ุฅุฑุณุงู ุฑุงุจุท ูู ูุฌููุนุฉ "${chatName}" ุฅูู ุงูุฎุงุต.`);
        } catch (err) {
            console.error('ูุดู ูู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุฅููู:', err);
        }
    }
});

// ุชุดุบูู ุงูุจูุช
client.initialize();